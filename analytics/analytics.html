<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="https://script-js.github.io/js-css/darkice.css" />
  </head>
  <body style="text-align:center">
  <h1 id="mytop">Loading Data...</h1>
  <h3 id="alltop">Loading Data...</h1>
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, update, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {

  apiKey: "AIzaSyDtRT41LIMJqmcSB5_A5G9FWFtuvMSHyjQ",

  authDomain: "jsurl-512e9.firebaseapp.com",

  databaseURL: "https://jsurl-512e9-default-rtdb.firebaseio.com",

  projectId: "jsurl-512e9",

  storageBucket: "jsurl-512e9.appspot.com",

  messagingSenderId: "371834717525",

  appId: "1:371834717525:web:58d2c0df75254f3b38dbdc"

};


  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase();
  const dbRef = ref(db);

  function decodeFB(text2) {
     var text1 = text2.replaceAll("%2E",".").replaceAll("%23","#").replaceAll("%24","$").replaceAll("%2F","/").replaceAll("%5B","[").replaceAll("%5D","]").replaceAll('%22','"')
     return text1;
   }

  get(child(dbRef, "/analytics")).then((snapshot) => {
  if (snapshot.exists()) {
    var gdata = snapshot.val();
    var tosort = {}
    window.tosort = tosort
    Object.keys(gdata).forEach(function (k) {
       get(child(dbRef,"/analytics")).then((snapshot) => {
  if (snapshot.exists()) {
      var an = snapshot.val()
      Object.keys(an).forEach(function (k) {
        if (tosort[k]) {
          tosort[k] = tosort[k] + an[k]
        } else {
          tosort[k] = an[k]
        }
      });
  }
       });
    });
    setTimeout(function() {
    var sortedArray = Object.entries(tosort)
    .sort((a, b) => b[1] - a[1])
    .reduce((acc, [key, value]) => ({ ...acc, [key]: value }), {});
    var atText = "<ol>";
    Object.keys(sortedArray).forEach(function (k) {
      atText = atText + "<li><a href='go.html?url=" + decodeFB(k) + "'>" + decodeFB(k) + "</a> (" + sortedArray[k] + " plays)" + "</li>";
    });
    alltop.innerHTML = "Top Games (most - least popular): " + atText + "</ol>"
    },1000)
  } else {alltop.innerHTML = "Error Getting Data"};
});
  </script>
  </body>
</html>
